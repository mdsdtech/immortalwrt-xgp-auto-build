<%
local util = require "luci.util"
local fs = require "nixio.fs"

-- è¯»å–å¹¶è§£æžæ–‡ä»¶
local function parse_file(path)
    local data = {}
    local content = fs.readfile(path)
    if content then
        for line in content:gmatch("[^\r\n]+") do
            local key, value = line:match("^([%w_]+)='([^']*)'")
            if key and value then
                data[key] = value
            end
        end
    end
    return data
end

local build_info = parse_file("/etc/zz_build_id")
local release_info = parse_file("/etc/openwrt_release")
-%>

<style>
    #zzversion td {
        padding: 1.1em 1.25rem;
    }
</style>

<fieldset class="cbi-section">
    <h3>XiGuaPi Firmware Info</h3>
    <table id="zzversion" width="100%">
        <tr>
            <td width="33%" style="vertical-align:top">
                <strong>Version</strong>
            </td>
            <td>
                <%= release_info.ZZ_DISTRIB_NAME or "ðŸ¤ðŸ’™ðŸ’œ GFriendWRT ðŸ¤ðŸ’™ðŸ’œ by MDSDTech ðŸ¦…" %> <%= release_info.ZZ_DISTRIB_VERSION or "Development Version" %><br/>
                <%= release_info.DISTRIB_DESCRIPTION %>
            </td>
        </tr>
        <tr>
            <td width="33%" style="vertical-align:top">
                <strong>Build Info</strong>
            </td>
            <td>
                Build ID: <%= build_info.ZZ_BUILD_ID or "N/A" %><br/>
                Data: <%= build_info.ZZ_BUILD_DATE or "N/A" %><br/>
                Host: <%= build_info.ZZ_BUILD_HOST or "N/A" %><br/>
                User: <%= build_info.ZZ_BUILD_USER or "N/A" %>
            </td>
        </tr>
        <tr>
            <td width="33%" style="vertical-align:top">
                <strong>Repository Hash</strong>
            </td>
            <td>
                Repo Hash: <%= build_info.ZZ_BUILD_REPO_HASH or "N/A" %><br/>
                ImmortalWrt: <%= build_info.ZZ_BUILD_IMM_HASH or "N/A" %>
            </td>
        </tr>
    </table>
</fieldset>